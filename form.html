<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title></title>
	</head>
	<body onload="checkCookie()">
		<form
			action="https://signupapp2.com/signupapp/signups/process"
			method="post"
			onsubmit="validateEmail()"
			name="form"
		>
			<label>Email Address</label>
			<input
				type="text"
				name="signup.emailAddress"
				id="emailAddress"
				required
			/>

			<input name="signup.listCode" type="hidden" value="TRADEDAY" />

			<input name="signup.sourceId" type="hidden" value="XXTEST" />

			<input
				name="signup.welcomeEmailTemplateName"
				type="hidden"
				value="tradeday_generic"
			/>

			<input type="submit" value="Submit" />
		</form>
		<script type="text/javascript">
			function checkCookie() {
				// if a cookie exists, then display the thank you
				document.cookie && document.write("Thank you for signing up!");
			}

			function validateEmail() {
				var email = document.getElementById("emailAddress").value;
				var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

				if (regex.test(email)) {
					event.preventDefault(); // stops the redirection on successful signup
					createCookie();
				}
				return regex.test(email);
			}

			function createCookie() {
				// called when a valid email is given through validateEmail()

				var cookievalue = encodeURI(
					document.getElementById("emailAddress").value
				);
				var now = new Date();
				var time = now.getTime();
				var expireTime = time + 86400 * 1000; // expires in one day upon creation
				now.setTime(expireTime);
				var expires = now.toGMTString(); // must be in GMT string format

				// USE FIREFOX ~ Chrome does not support local cookies
				// https://stackoverflow.com/questions/8105135/cannot-set-cookies-in-javascript
				document.cookie = `name=${cookievalue};expires=${expires};`;
				// should show thank you instead of cookie
				document.write(document.cookie);
			}
		</script>
	</body>
</html>
